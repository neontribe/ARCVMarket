<template>
    <div>
        <main class="container fullwidth" id="account">

            <div class="content fullwidth">
                <h1>Requested Payments</h1>

                <div class="accordion">

                    <!-- Tab header -->
                    <div class="tab thead">
                        <label>
                            <div class="row">
                                <div>Request date</div>
                                <div class="total"></div>
                                <div>Amount</div>
                                <div></div>
                            </div>
                        </label>
                    </div>

                    <div class="tab row" v-for="(payment, index) in this.voucherPayments[0]">
                        <input :id="'tab-'+index" type="checkbox" name="tabs">
                        <label :for="'tab-'+index">
                            <div class="row">
                                <div> {{ payment.pended_on }}</div>
                                <div> {{ payment.vouchers.length }}</div>
                                <div class="amount">&pound;{{ payment.vouchers.length }}</div>
                                <div class="email"><i class="fa fa-envelope" aria-hidden="true" title="Send this record to my email"></i></div>
                            </div>
                        </label>
                        <div class="tab-content">
                            <div class="tab inner-thead">
                                <label>
                                    <div class="row-code">
                                        <div>Voucher code</div>
                                        <div>Voucher added on</div>
                                    </div>
                                </label>
                            </div>
                            <div class="tab" v-for="voucher in payment.vouchers">
                                <label>
                                    <div class="row-code">
                                        <div class="code">{{ voucher.code }}</div>
                                        <div class="date">{{ voucher.recorded_on }}</div>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>

                </div>

                <button id="requestVoucherHistoryEmail" v-on:click="onRequestVoucherHistoryEmail(null)">Email payment history</button>

            </div>

        </main>
    </div>
</template>

<script>
    import Store from '../store.js';
    import NetMgr from '../services/netMgr.js';
    export default {
        name: 'account',
        data() {
            return {
                voucherPayments: Store.trader.pendedVouchers
            }
        },
        created: function () {

        },
        methods: {
            onRequestVoucherHistoryEmail(submittedOn) {
                NetMgr.apiPost('/traders/' + Store.trader.id + '/voucher-history-email?submission_date=' + submittedOn,
                    function (response) {
                        if (success) { success(response) }
                    },
                    function () {
                        if (failure) { failure(error) }
                    }
                );
            }
        },
        mounted: function () {
            Store.getVoucherPaymentState();
        }
    }
</script>
